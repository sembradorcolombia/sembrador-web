# AGENT.md

Guidelines for AI coding agents working on this codebase.

## Code Style

- **Biome** enforces all linting and formatting — run `pnpm check` before committing
- **Indentation:** tabs (not spaces)
- **Quotes:** double quotes
- **TypeScript:** strict mode — no unused variables or parameters
- **Imports:** use `@/` path alias (e.g., `import { Button } from "@/components/ui/button"`)

## Auto-Generated Files — DO NOT Edit

- `src/routeTree.gen.ts` — generated by TanStack Router from `src/routes/`
- `src/lib/database.types.ts` — generated by Supabase CLI from the database schema

## Component Patterns

### UI Components (`src/components/ui/`)

Built with CVA (class-variance-authority) + Radix UI primitives + tailwind-merge:

```tsx
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@/lib/utils";

const buttonVariants = cva("base-classes", {
	variants: {
		variant: { default: "...", outline: "..." },
		size: { default: "...", sm: "...", lg: "..." },
	},
	defaultVariants: { variant: "default", size: "default" },
});
```

- All styling uses Tailwind utility classes — no CSS modules, no inline styles
- Use `cn()` from `@/lib/utils` to merge conditional classes

### Feature Components

Organized by feature domain:
- `src/components/dashboard/` — admin dashboard components
- `src/components/equilibrio/` — event showcase components
- `src/components/forms/` — form components

## Data Layer

### Server State (TanStack Query)

- Service functions in `src/lib/services/` make Supabase calls
- Custom hooks in `src/lib/hooks/` wrap queries and mutations
- Pattern: `useQuery` for reads, `useMutation` for writes with `onSuccess` invalidation

### Auth

- `useAuth()` hook provides session state globally via router context
- Admin check: `session.user.app_metadata.is_admin`
- Protected routes use `beforeLoad` to redirect unauthenticated users to `/login`

## Forms

Use TanStack Form with the Zod adapter:

```tsx
import { useForm } from "@tanstack/react-form";
import { zodValidator } from "@tanstack/zod-form-adapter";
```

- Validation schemas live in `src/lib/validations/`
- Email validation includes disposable domain blocking and test email detection

## Routing

- File-based routing via TanStack Router — add files to `src/routes/`
- Route tree regenerates automatically on dev server
- Layout routes: `equilibrio.tsx` wraps child routes under `/equilibrio/*`
- Router context carries `{ auth: AuthState }` for auth-aware routing

## Testing

### Unit Tests (Vitest)

- Test files: `__tests__/*.test.ts(x)` next to the code they test
- Setup: `src/test/setup.ts` (includes @testing-library/jest-dom matchers)
- Run: `pnpm test` (single run) or `pnpm test:watch`

### E2E Tests (Playwright)

- Test files: `e2e/*.spec.ts`
- Browser: Chromium only
- Base URL: `http://localhost:3000`
- Run: `pnpm test:e2e` (requires dev server running or auto-starts it)

## Theme & Styling

Custom theme defined in `src/styles.css`:

- **Colors:** primary (#FF2D77), primary-dark (#CC245F), secondary (#1D13BD), secondary-dark (#100A66)
- **Fonts:** Montserrat (sans), Right Grotesk (grotesk — 4 variants with different weights/stretches)
- **Custom utilities:** `font-grotesk-wide-medium`, `font-grotesk-spatial-black`, `font-grotesk-tight-medium`, `font-grotesk-compact-black`

## Analytics

- **GA4:** tracked via `window.gtag` — PageView on route changes
- **Meta Pixel:** tracked via `window.fbq` — PageView on `/equilibrio` routes, custom events for subscription actions
- Both configured through `VITE_*` environment variables
